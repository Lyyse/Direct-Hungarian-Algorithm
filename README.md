This is less practical than the matrix implementation but I feel like the connection to the original algorithm is clearer since I haven't really understood how the matrix one works. Code is probably very inefficient in many places.
